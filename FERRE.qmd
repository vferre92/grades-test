---
title: "FERRE"
format: html
---

Link to the github repository : https://github.com/vferre92/grades-test.git


```{r}

#| false
here::i_am("grades-test.Rproj")
library(here)
library(dplyr)
library(tidyr)
library(ggplot2)
library(vroom)
library(gt)
library(readr)
library(lubridate)

```

### 1.1 Study organisation

#### Question 1 :  Load the course description file.

```{r}
courses <- vroom(here("data", "courses.csv"))
View(courses)

```
### Question 2 :

```{r}
courses |>
  arrange(course) |>
  gt::gt() |>
  tab_header(title = "Courses Data")

```


###  1.2 Students

####  Question 3

```{r}
students <- vroom(here("data", "students.csv"))
View(students)

```
```{r}
print(class(students$birth_date)) 
```
The variable "birth_date" is of class " `{r} print(class(students$birth_date))` "

```{r}
print(class(students$sex)) 
```

The variable "sex" is of class " `{r} print(class(students$sex))` "
Transformons la variable "sex" en *factor* :

```{r}
students <- students |>
  mutate(sex = factor(sex)) 
print(class(students$sex))
```
The variable "sex" is now of class " `{r} print(class(students$sex))` "

####  Question 4

```{r}

grades <- vroom(here("data", "grades.csv"))
View(grades)

```
ProblÃ¨me d'encodage, changeons cela :

```{r}

grades <- vroom(here("data", "grades.csv"), delim = ":", na = "unknown")
View(grades)

```
#### Question 5

```{r}

students |>
  ggplot(aes(x = factor(group))) +
  geom_bar(fill = "steelblue") +
  labs(title = "Number of Students per Group", x = "Group", y = "Nb of Students") +
  geom_text(stat = 'count', aes(label = after_stat(count)), vjust = -0.5) +
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5)) +
  scale_x_discrete(breaks = c("1", "2", "3", "4", "5", "6", "7", "8", "9", "10", "11", "12", "13", "14", "15", "16", "17", "18"))

```

#### Question 6

```{r}

students |>
  ggplot(aes(x = group, fill = sex)) +
  geom_bar(position = "fill") +
  labs(title = "Gender Balance in Each Group", x = "Group Number", y = "Proportion of Students") +
  scale_fill_manual(values = c("lightgreen", "lightsalmon")) +
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5)) 

```
#### Question 7 

```{r}
students <- students |>
  mutate(age = round(time_length(today() - birth_date, unit = "year")))

students |>
  ggplot(aes(x = age)) +
  geom_histogram(binwidth = 1, fill = "lightblue", color = "darkblue") +
  labs(title = "Distribution of Students' age (Count)", x = "age", y = "Count of Students") +
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5))
```
#### Question 8 

```{r}
students <- students |>
  mutate(age = round(time_length(today() - birth_date, unit = "year")))

median_age_by_group <- students |>
  group_by(group) |>
  summarise(Median_age = median(age, na.rm = TRUE)) |>
  ungroup() |>
  mutate(Median_age = round(Median_age))

median_age_by_group |>
  gt::gt() |>
  tab_header(title = "Median Age of Students by Group") |>
  cols_label(group = "Group ID", Median_age = "Median Age") |>
  fmt_number(columns = Median_age, decimals = 0)
```

#### Question 9

```{r}

oldest_students <- students |>
  group_by(group) |>
  slice_max(age, n = 1) |>
  ungroup() |>
  select(id, sex, age, group) |>
  arrange(desc(age))

oldest_students |>
  gt() |>
  tab_header(title = "Oldest Student in Each Group") |>
  cols_label(id = "Student ID",sex = "Gender",age = "Age", group = "nb_Group") |>
  fmt_number(columns = age, decimals = 0)


```

### 3 Simple grade analysis

#### Question 10

```{r}
nb_grades <- grades |>
  filter(!is.na(grade)) |>
  nrow()
```

Le nombre de notes, sans compter les missings values, est de `r nb_grades`.

#### Question 11

```{r}

grades_courses <- grades |>
  inner_join(courses, by = "course_id")

```

```{r}

grades_courses |>
  inner_join(students |> select(id, group), by = "id") |>
  filter(course == "Post-Apocalyptic History and Archaeology") |>
  group_by(group) |>
  summarise(avg_grade = mean(grade, na.rm = TRUE)) |>
  ungroup() |>
  ggplot(aes(x = factor(group), y = avg_grade)) +
  geom_col(fill = "steelblue") +
  labs(title = "Average Grade in Post-Apocalyptic History and Archaeology by Group",x = "Group ID",y = "Average Grade") +
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5))

```

#### Question 12

```{r}

grades_courses |>
  filter(!is.na(grade)) |>
  ggplot(aes(x = grade)) +
  geom_boxplot(fill = "lightblue", color = "darkblue") +
  facet_wrap(vars(trimester)) +
  labs(title = "Distribution of Grades by Trimester",x = "Grade",y = "Density") +
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5))

```
###  4 Attendance analysis

#### Question 13

```{r}
grades_courses_students <- grades_courses |>
  inner_join(students |> select(id, group, sex), by = "id")

grades_per_student <- grades_courses_students |>
  group_by(id, group, sex) |>
  filter(!is.na(grade)) |>
  summarise(nb_grades = n(), .groups = "drop") |>
  ungroup()
```

```{r}
grades_per_student |>
  slice_head(n = 10) |>
  gt() |>
  tab_header(
    title = "Extract of Grades per Student") |>
  cols_label(id = "Student ID",group = "Group ID",sex = "Gender",nb_grades = "Number of Grades")

```

#### Question 14
